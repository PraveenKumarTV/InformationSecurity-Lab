<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diffie-Hellman Key Exchange Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
        }
        
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #fdbb2d;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .characters-area {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .character {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.5s, box-shadow 0.5s;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }
        
        .character.active {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(253, 187, 45, 0.9);
            background: rgba(253, 187, 45, 0.2);
        }
        
        .character-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid #fdbb2d;
        }
        
        .character h2 {
            margin-bottom: 15px;
            color: #fdbb2d;
        }
        
        .value-display {
            font-size: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            width: 100%;
        }
        
        .input-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .input-area h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #fdbb2d;
        }
        
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
            flex: 1;
        }
        
        .input-group label {
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .input-group input {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #fdbb2d;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1.1rem;
        }
        
        button {
            padding: 12px 25px;
            background: #fdbb2d;
            color: #1a2a6c;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin: 5px;
        }
        
        button:hover {
            background: #ffcc44;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .animation-area {
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .data-packet {
            width: 80px;
            height: 80px;
            background: #fdbb2d;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: absolute;
            transition: all 3s ease-in-out;
            box-shadow: 0 0 15px rgba(253, 187, 45, 0.7);
            z-index: 10;
        }
        
        .eavesdropper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            opacity: 0.3;
            z-index: 5;
        }
        
        .character-expression {
            font-size: 2rem;
            margin-top: 10px;
            height: 40px;
        }
        
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .error {
            color: #f44336;
            font-weight: bold;
        }
        
        .message-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        
        .message-area h2 {
            color: #fdbb2d;
            margin-bottom: 15px;
        }
        
        .message-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
        }
        
        .message {
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            font-family: 'Courier New', monospace;
            min-width: 200px;
            text-align: center;
            transition: all 2s;
        }
        
        .encrypted {
            background: #f44336;
            color: white;
        }
        
        .decrypted {
            background: #4CAF50;
            color: white;
        }
        
        .message-btn {
            margin-top: 15px;
        }
        
        @media (max-width: 900px) {
            .characters-area {
                grid-template-columns: 1fr;
            }
            
            .input-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>Diffie-Hellman Key Exchange Game</h1>
    <p class="subtitle">Learn how two parties can establish a shared secret over an insecure channel</p>
    
    <div class="container">
        <div class="game-container">
            <div class="characters-area">
                <div class="character" id="character-alice">
                    <div class="character-img">üë©‚Äçüíª</div>
                    <h2>Alice</h2>
                    <div class="character-expression" id="alice-expression">üòä</div>
                    <div class="value-display" id="alice-secret">Secret: ?</div>
                    <div class="value-display" id="alice-public">Public: ?</div>
                    <div class="value-display" id="alice-shared">Shared Key: ?</div>
                </div>
                
                <div class="character" id="character-eve">
                    <div class="character-img">üëÇ</div>
                    <h2>Eve (Eavesdropper)</h2>
                    <div class="character-expression" id="eve-expression">üòè</div>
                    <div class="value-display" id="eve-info">Listening...</div>
                    <div class="value-display" id="eve-capture">Public Keys: ?</div>
                    <div class="value-display" id="eve-failed">Shared Key: ?</div>
                </div>
                
                <div class="character" id="character-bob">
                    <div class="character-img">üë®‚Äçüíª</div>
                    <h2>Bob</h2>
                    <div class="character-expression" id="bob-expression">üòä</div>
                    <div class="value-display" id="bob-secret">Secret: ?</div>
                    <div class="value-display" id="bob-public">Public: ?</div>
                    <div class="value-display" id="bob-shared">Shared Key: ?</div>
                </div>
            </div>
            
            <div class="animation-area" id="animation-area">
                <div class="eavesdropper">üëÇ</div>
                <div class="data-packet" id="packet-to-bob" style="left: -100px;">A ‚Üí B</div>
                <div class="data-packet" id="packet-to-alice" style="right: -100px;">B ‚Üí A</div>
            </div>
            
            <div class="input-area">
                <h2>Configuration</h2>
                <div class="input-row">
                    <div class="input-group">
                        <label for="prime-input">Prime Number (p):</label>
                        <input type="number" id="prime-input" placeholder="Enter a prime number" min="2" value="23">
                    </div>
                    
                    <div class="input-group">
                        <label for="base-input">Base Number (g):</label>
                        <input type="number" id="base-input" placeholder="Enter a base number" min="2" value="5">
                    </div>
                    
                    <div class="input-group">
                        <label for="alice-secret-input">Alice's Secret Number (a):</label>
                        <input type="number" id="alice-secret-input" placeholder="Alice's secret" min="1" value="6">
                    </div>
                    
                    <div class="input-group">
                        <label for="bob-secret-input">Bob's Secret Number (b):</label>
                        <input type="number" id="bob-secret-input" placeholder="Bob's secret" min="1" value="15">
                    </div>
                </div>
                
                <div class="buttons">
                    <button id="validate-btn">Validate Inputs</button>
                    <button id="calculate-btn">Calculate Public Keys</button>
                    <button id="exchange-btn">Exchange Public Keys</button>
                    <button id="compute-btn">Compute Shared Secret</button>
                    <button id="reset-btn">Reset Game</button>
                </div>
            </div>
            
            <div class="message-area" id="message-area">
                <h2>Secure Message Exchange</h2>
                <div class="message-container">
                    <div class="message" id="alice-message">Hello Bob!</div>
                    <div class="message encrypted" id="encrypted-message">%#@$*&!</div>
                    <div class="message" id="bob-message">Hello Bob!</div>
                </div>
                <button id="send-message-btn" class="message-btn">Send Encrypted Message</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const primeInput = document.getElementById('prime-input');
            const baseInput = document.getElementById('base-input');
            const aliceSecretInput = document.getElementById('alice-secret-input');
            const bobSecretInput = document.getElementById('bob-secret-input');
            
            const aliceSecretDisplay = document.getElementById('alice-secret');
            const alicePublicDisplay = document.getElementById('alice-public');
            const aliceSharedDisplay = document.getElementById('alice-shared');
            const aliceExpression = document.getElementById('alice-expression');
            
            const bobSecretDisplay = document.getElementById('bob-secret');
            const bobPublicDisplay = document.getElementById('bob-public');
            const bobSharedDisplay = document.getElementById('bob-shared');
            const bobExpression = document.getElementById('bob-expression');
            
            const eveInfo = document.getElementById('eve-info');
            const eveCapture = document.getElementById('eve-capture');
            const eveFailed = document.getElementById('eve-failed');
            const eveExpression = document.getElementById('eve-expression');
            
            const validateBtn = document.getElementById('validate-btn');
            const calculateBtn = document.getElementById('calculate-btn');
            const exchangeBtn = document.getElementById('exchange-btn');
            const computeBtn = document.getElementById('compute-btn');
            const resetBtn = document.getElementById('reset-btn');
            const sendMessageBtn = document.getElementById('send-message-btn');
            
            const packetToBob = document.getElementById('packet-to-bob');
            const packetToAlice = document.getElementById('packet-to-alice');
            
            const characterAlice = document.getElementById('character-alice');
            const characterBob = document.getElementById('character-bob');
            const characterEve = document.getElementById('character-eve');
            
            const aliceMessage = document.getElementById('alice-message');
            const encryptedMessage = document.getElementById('encrypted-message');
            const bobMessage = document.getElementById('bob-message');
            
            const messageArea = document.getElementById('message-area');

            // Game state
            let state = {
                p: 0,
                g: 0,
                a: 0,
                b: 0,
                A: 0,
                B: 0,
                s: 0,
                validated: false,
                calculated: false,
                exchanged: false,
                computed: false,
                messageSent: false
            };
            
            // Utility function for modular exponentiation
            function modExp(base, exponent, modulus) {
                if (modulus === 1) return 0;
                let result = 1;
                base = base % modulus;
                while (exponent > 0) {
                    if (exponent % 2 === 1) {
                        result = (result * base) % modulus;
                    }
                    exponent = Math.floor(exponent / 2);
                    base = (base * base) % modulus;
                }
                return result;
            }
            
            // Check if a number is prime
            function isPrime(num) {
                if (num <= 1) return false;
                if (num <= 3) return true;
                if (num % 2 === 0 || num % 3 === 0) return false;
                
                let i = 5;
                while (i * i <= num) {
                    if (num % i === 0 || num % (i + 2) === 0) return false;
                    i += 6;
                }
                return true;
            }
            
            // Update character expressions
            function updateExpressions() {
                if (state.validated) {
                    aliceExpression.textContent = 'üòä';
                    bobExpression.textContent = 'üòä';
                    eveExpression.textContent = 'üòè';
                }
                
                if (state.calculated) {
                    aliceExpression.textContent = 'ü§î';
                    bobExpression.textContent = 'ü§î';
                }
                
                if (state.exchanged) {
                    aliceExpression.textContent = 'üì§';
                    bobExpression.textContent = 'üì§';
                    eveExpression.textContent = 'üëÇ';
                }
                
                if (state.computed) {
                    aliceExpression.textContent = 'üîë';
                    bobExpression.textContent = 'üîë';
                    eveExpression.textContent = 'üò†';
                }
                
                if (state.messageSent) {
                    aliceExpression.textContent = '‚úâÔ∏è';
                    bobExpression.textContent = 'üì©';
                    eveExpression.textContent = 'üòñ';
                }
            }
            
            // Validate inputs
            validateBtn.addEventListener('click', function() {
                const p = parseInt(primeInput.value);
                const g = parseInt(baseInput.value);
                const a = parseInt(aliceSecretInput.value);
                const b = parseInt(bobSecretInput.value);
                
                if (isNaN(p) || isNaN(g) || isNaN(a) || isNaN(b)) {
                    alert('Please enter valid numbers in all fields.');
                    return;
                }
                
                if (!isPrime(p)) {
                    alert('The prime number (p) must be a prime number.');
                    return;
                }
                
                if (g >= p) {
                    alert('The base number (g) must be less than the prime number (p).');
                    return;
                }
                
                if (a <= 0 || b <= 0) {
                    alert('Secret numbers must be positive integers.');
                    return;
                }
                
                if (a >= p || b >= p) {
                    alert('Secret numbers must be less than the prime number (p).');
                    return;
                }
                
                // Update state
                state.p = p;
                state.g = g;
                state.a = a;
                state.b = b;
                state.validated = true;
                
                // Update displays
                aliceSecretDisplay.textContent = `Secret: ${a}`;
                bobSecretDisplay.textContent = `Secret: ${b}`;
                alicePublicDisplay.textContent = 'Public: ?';
                bobPublicDisplay.textContent = 'Public: ?';
                
                // Update expressions
                updateExpressions();
                
                // Visual feedback
                validateBtn.classList.add('success');
                setTimeout(() => validateBtn.classList.remove('success'), 1000);
                
                setTimeout(() => {
                    alert('Inputs are valid! You can now calculate public keys.');
                }, 500);
            });
            
            // Calculate public keys
            calculateBtn.addEventListener('click', function() {
                if (!state.validated) {
                    alert('Please validate inputs first.');
                    return;
                }
                
                // Calculate public keys
                state.A = modExp(state.g, state.a, state.p);
                state.B = modExp(state.g, state.b, state.p);
                
                // Update displays
                alicePublicDisplay.textContent = `Public: ${state.A}`;
                bobPublicDisplay.textContent = `Public: ${state.B}`;
                
                state.calculated = true;
                
                // Update expressions
                updateExpressions();
                
                // Visual feedback
                calculateBtn.classList.add('success');
                setTimeout(() => calculateBtn.classList.remove('success'), 1000);
                
                setTimeout(() => {
                    alert('Public keys calculated! You can now exchange them.');
                }, 500);
            });
            
            // Exchange public keys
            exchangeBtn.addEventListener('click', function() {
                if (!state.calculated) {
                    alert('Please calculate public keys first.');
                    return;
                }
                
                // Update expressions
                updateExpressions();
                
                // Animate the exchange (slower animation)
                packetToBob.style.left = 'calc(100% + 100px)';
                packetToAlice.style.right = 'calc(100% + 100px)';
                
                // Show Eve capturing the public keys
                setTimeout(() => {
                    eveCapture.textContent = `Public Keys: A=${state.A}, B=${state.B}`;
                    eveExpression.textContent = 'üòè';
                }, 1500);
                
                setTimeout(() => {
                    packetToBob.style.left = '-100px';
                    packetToAlice.style.right = '-100px';
                    
                    // Update state
                    state.exchanged = true;
                    
                    // Update expressions
                    updateExpressions();
                    
                    // Visual feedback
                    exchangeBtn.classList.add('success');
                    setTimeout(() => exchangeBtn.classList.remove('success'), 1000);
                    
                    setTimeout(() => {
                        alert('Public keys exchanged! Eve captured them, but she cannot compute the shared secret without the private keys.');
                    }, 500);
                }, 3000);
            });
            
            // Compute shared secret
            computeBtn.addEventListener('click', function() {
                if (!state.exchanged) {
                    alert('Please exchange public keys first.');
                    return;
                }
                
                // Compute shared secret
                const s1 = modExp(state.B, state.a, state.p); // Alice's computation
                const s2 = modExp(state.A, state.b, state.p); // Bob's computation
                
                if (s1 !== s2) {
                    alert('Error: Shared secrets do not match!');
                    return;
                }
                
                state.s = s1;
                
                // Update displays
                aliceSharedDisplay.textContent = `Shared Key: ${state.s}`;
                bobSharedDisplay.textContent = `Shared Key: ${state.s}`;
                
                // Show that Eve cannot compute the secret
                eveFailed.textContent = 'Shared Key: Cannot Compute!';
                eveFailed.classList.add('error');
                
                // Highlight both characters
                characterAlice.classList.add('active');
                characterBob.classList.add('active');
                
                state.computed = true;
                
                // Update expressions
                updateExpressions();
                
                // Visual feedback
                computeBtn.classList.add('success');
                setTimeout(() => computeBtn.classList.remove('success'), 1000);
                
                // Show message area
                messageArea.style.display = 'block';
                
                setTimeout(() => {
                    alert(`Success! Shared secret key is: ${state.s}\nEve cannot compute it without the private keys.\nNow you can send an encrypted message.`);
                }, 500);
            });
            
            // Send encrypted message
            sendMessageBtn.addEventListener('click', function() {
                if (!state.computed) {
                    alert('Please compute the shared secret first.');
                    return;
                }
                
                // Animate message sending
                aliceMessage.style.opacity = '0.5';
                encryptedMessage.style.transform = 'scale(1.2)';
                encryptedMessage.style.opacity = '1';
                
                setTimeout(() => {
                    encryptedMessage.style.transform = 'scale(1)';
                    bobMessage.classList.add('decrypted');
                    state.messageSent = true;
                    updateExpressions();
                    
                    // Visual feedback
                    sendMessageBtn.classList.add('success');
                    setTimeout(() => sendMessageBtn.classList.remove('success'), 1000);
                    
                    setTimeout(() => {
                        alert('Message successfully encrypted, sent, and decrypted! Eve cannot read it without the shared key.');
                    }, 500);
                }, 2000);
            });
            
            // Reset the game
            resetBtn.addEventListener('click', function() {
                // Reset state
                state = {
                    p: 0,
                    g: 0,
                    a: 0,
                    b: 0,
                    A: 0,
                    B: 0,
                    s: 0,
                    validated: false,
                    calculated: false,
                    exchanged: false,
                    computed: false,
                    messageSent: false
                };
                
                // Reset inputs
                primeInput.value = "23";
                baseInput.value = "5";
                aliceSecretInput.value = "6";
                bobSecretInput.value = "15";
                
                // Reset displays
                aliceSecretDisplay.textContent = 'Secret: ?';
                alicePublicDisplay.textContent = 'Public: ?';
                aliceSharedDisplay.textContent = 'Shared Key: ?';
                
                bobSecretDisplay.textContent = 'Secret: ?';
                bobPublicDisplay.textContent = 'Public: ?';
                bobSharedDisplay.textContent = 'Shared Key: ?';
                
                eveInfo.textContent = 'Listening...';
                eveCapture.textContent = 'Public Keys: ?';
                eveFailed.textContent = 'Shared Key: ?';
                eveFailed.classList.remove('error');
                
                // Reset expressions
                aliceExpression.textContent = 'üòä';
                bobExpression.textContent = 'üòä';
                eveExpression.textContent = 'üòè';
                
                // Reset animations
                packetToBob.style.left = '-100px';
                packetToAlice.style.right = '-100px';
                
                // Remove highlights
                characterAlice.classList.remove('active');
                characterBob.classList.remove('active');
                
                // Reset message area
                aliceMessage.style.opacity = '1';
                encryptedMessage.style.transform = 'scale(1)';
                encryptedMessage.style.opacity = '0.7';
                bobMessage.classList.remove('decrypted');
                
                // Remove success classes from buttons
                document.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('success');
                });
                
                setTimeout(() => {
                    alert('Game has been reset! You can start over.');
                }, 500);
            });
        });
    </script>
</body>
</html>