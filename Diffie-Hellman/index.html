<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diffie-Hellman Key Exchange Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            background: #f7fafc;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e2e8f0;
        }

        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        label {
            font-weight: 600;
            color: #4a5568;
            min-width: 120px;
        }

        input {
            padding: 10px 15px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .characters {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            margin: 30px 0;
            align-items: start;
        }

        .character {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .character::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .character.alice::before { background: linear-gradient(90deg, #4299e1, #3182ce); }
        .character.bob::before { background: linear-gradient(90deg, #48bb78, #38a169); }
        .character.eve::before { background: linear-gradient(90deg, #ed8936, #dd6b20); }

        .character.active {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .character-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .character-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .alice .character-avatar { background: linear-gradient(45deg, #4299e1, #3182ce); }
        .bob .character-avatar { background: linear-gradient(45deg, #48bb78, #38a169); }
        .eve .character-avatar { background: linear-gradient(45deg, #ed8936, #dd6b20); }

        .character-name {
            font-size: 1.5em;
            font-weight: 700;
            color: #2d3748;
        }

        .character-role {
            font-size: 0.9em;
            color: #718096;
            margin-left: 5px;
        }

        .values {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .value-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .value-row:hover {
            background: #edf2f7;
        }

        .value-label {
            font-weight: 600;
            color: #4a5568;
        }

        .value-number {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #2d3748;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }

        .secret {
            color: #e53e3e !important;
            background: #fed7d7 !important;
            border-color: #fc8181 !important;
        }

        .shared {
            color: #38a169 !important;
            background: #c6f6d5 !important;
            border-color: #68d391 !important;
        }

        .middle-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .exchange-arrow {
            font-size: 24px;
            margin: 10px;
            transition: all 0.5s ease;
            color: #667eea;
        }

        .exchange-arrow.animated {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .step-indicator {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.5s ease;
        }

        .step-indicator.active {
            opacity: 1;
            transform: translateY(0);
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 600;
            font-size: 1.1em;
        }

        .status.success {
            background: #c6f6d5;
            color: #2f855a;
            border: 2px solid #68d391;
        }

        .status.warning {
            background: #feebc8;
            color: #c05621;
            border: 2px solid #f6ad55;
        }

        .status.info {
            background: #bee3f8;
            color: #2c5aa0;
            border: 2px solid #63b3ed;
        }

        .explanation {
            background: #edf2f7;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .formula {
            font-family: 'Courier New', monospace;
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .highlight {
            background: #fef5e7;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid #f6ad55;
        }

        @media (max-width: 768px) {
            .characters {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            label {
                min-width: auto;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Diffie-Hellman Key Exchange Demo</h1>
        
        <div class="controls">
            <div class="input-group">
                <label for="prime">Prime (p):</label>
                <input type="number" id="prime" value="23" min="2" max="1000">
                
                <label for="generator">Generator (g):</label>
                <input type="number" id="generator" value="5" min="2" max="100">
                
                <label for="aliceSecret">Alice's Secret (a):</label>
                <input type="number" id="aliceSecret" value="6" min="1" max="100">
                
                <label for="bobSecret">Bob's Secret (b):</label>
                <input type="number" id="bobSecret" value="15" min="1" max="100">
            </div>
            
            <div style="text-align: center;">
                <button onclick="startExchange()">üöÄ Start Key Exchange</button>
                <button onclick="reset()">üîÑ Reset</button>
                <button onclick="randomValues()">üé≤ Random Values</button>
            </div>
        </div>

        <div id="status" class="status info">
            Enter values and click "Start Key Exchange" to begin the demonstration!
        </div>

        <div class="characters">
            <div class="character alice" id="alice">
                <div class="character-header">
                    <div class="character-avatar">A</div>
                    <div>
                        <div class="character-name">Alice</div>
                        <div class="character-role">Sender</div>
                    </div>
                </div>
                <div class="values">
                    <div class="value-row">
                        <span class="value-label">Public Prime (p):</span>
                        <span class="value-number" id="alice-p">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Public Generator (g):</span>
                        <span class="value-number" id="alice-g">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Private Secret (a):</span>
                        <span class="value-number secret" id="alice-a">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Public Value (A):</span>
                        <span class="value-number" id="alice-A">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Received from Bob (B):</span>
                        <span class="value-number" id="alice-B">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Shared Secret (K):</span>
                        <span class="value-number shared" id="alice-K">-</span>
                    </div>
                </div>
            </div>

            <div class="middle-section">
                <div class="step-indicator" id="step">Waiting to start...</div>
                <div class="exchange-arrow" id="arrow1">‚ü∑</div>
                <div style="text-align: center; margin: 10px;">
                    <div style="font-weight: 600; color: #4a5568;">Public Channel</div>
                    <div style="font-size: 0.9em; color: #718096;">Eve can see everything here</div>
                </div>
                <div class="exchange-arrow" id="arrow2">‚ü∑</div>
            </div>

            <div class="character bob" id="bob">
                <div class="character-header">
                    <div class="character-avatar">B</div>
                    <div>
                        <div class="character-name">Bob</div>
                        <div class="character-role">Receiver</div>
                    </div>
                </div>
                <div class="values">
                    <div class="value-row">
                        <span class="value-label">Public Prime (p):</span>
                        <span class="value-number" id="bob-p">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Public Generator (g):</span>
                        <span class="value-number" id="bob-g">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Private Secret (b):</span>
                        <span class="value-number secret" id="bob-b">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Public Value (B):</span>
                        <span class="value-number" id="bob-B">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Received from Alice (A):</span>
                        <span class="value-number" id="bob-A">-</span>
                    </div>
                    <div class="value-row">
                        <span class="value-label">Shared Secret (K):</span>
                        <span class="value-number shared" id="bob-K">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="character eve" id="eve" style="margin-top: 30px;">
            <div class="character-header">
                <div class="character-avatar">E</div>
                <div>
                    <div class="character-name">Eve</div>
                    <div class="character-role">Eavesdropper</div>
                </div>
            </div>
            <div class="values">
                <div class="value-row">
                    <span class="value-label">Knows Prime (p):</span>
                    <span class="value-number" id="eve-p">-</span>
                </div>
                <div class="value-row">
                    <span class="value-label">Knows Generator (g):</span>
                    <span class="value-number" id="eve-g">-</span>
                </div>
                <div class="value-row">
                    <span class="value-label">Intercepted A:</span>
                    <span class="value-number" id="eve-A">-</span>
                </div>
                <div class="value-row">
                    <span class="value-label">Intercepted B:</span>
                    <span class="value-number" id="eve-B">-</span>
                </div>
                <div class="value-row">
                    <span class="value-label">Can't compute K:</span>
                    <span class="value-number" id="eve-K">‚ùå</span>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h3>üßÆ Mathematical Steps:</h3>
            <div id="calculations" style="margin-top: 10px;">
                <p>The calculations will appear here during the demonstration...</p>
            </div>
        </div>

        <div class="explanation">
            <h3>üéØ How it Works:</h3>
            <p><strong>1. Public Parameters:</strong> Alice and Bob agree on a large prime number (p) and a generator (g). These can be shared publicly.</p>
            <p><strong>2. Private Secrets:</strong> Alice chooses a secret number (a), Bob chooses a secret number (b). These are never shared!</p>
            <p><strong>3. Public Exchange:</strong> Alice computes A = g^a mod p and sends it to Bob. Bob computes B = g^b mod p and sends it to Alice.</p>
            <p><strong>4. Shared Secret:</strong> Alice computes K = B^a mod p, Bob computes K = A^b mod p. Both get the same result!</p>
            <p><strong>5. Security:</strong> Eve can see p, g, A, and B, but can't determine a or b (discrete logarithm problem), so she can't compute K.</p>
        </div>
    </div>

    <script>
        
        let currentStep = 0;
        let isAnimating = false;

        // Modular exponentiation function
        function modPow(base, exp, mod) {
            if (mod === 1) return 0;
            let result = 1;
            base = base % mod;
            while (exp > 0) {
                if (exp % 2 === 1) {
                    result = (result * base) % mod;
                }
                exp = Math.floor(exp / 2);
                base = (base * base) % mod;
            }
            return result;
        }

        // Check if number is prime
        function isPrime(n) {
            if (n < 2) return false;
            for (let i = 2; i <= Math.sqrt(n); i++) {
                if (n % i === 0) return false;
            }
            return true;
        }

        // Validate inputs
        function validateInputs() {
            const p = parseInt(document.getElementById('prime').value);
            const g = parseInt(document.getElementById('generator').value);
            const a = parseInt(document.getElementById('aliceSecret').value);
            const b = parseInt(document.getElementById('bobSecret').value);

            if (!isPrime(p)) {
                updateStatus('‚ùå Prime (p) must be a prime number!', 'warning');
                return false;
            }

            if (g >= p || g < 2) {
                updateStatus('‚ùå Generator (g) must be between 2 and p-1!', 'warning');
                return false;
            }

            if (a >= p || a < 1) {
                updateStatus('‚ùå Alice\'s secret must be between 1 and p-1!', 'warning');
                return false;
            }

            if (b >= p || b < 1) {
                updateStatus('‚ùå Bob\'s secret must be between 1 and p-1!', 'warning');
                return false;
            }

            return true;
        }

        function updateStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function updateStep(message) {
            const step = document.getElementById('step');
            step.textContent = message;
            step.classList.add('active');
        }

        function animateCharacter(characterId, duration = 1000) {
            const char = document.getElementById(characterId);
            char.classList.add('active');
            setTimeout(() => char.classList.remove('active'), duration);
        }

        function animateArrows() {
            document.getElementById('arrow1').classList.add('animated');
            document.getElementById('arrow2').classList.add('animated');
            setTimeout(() => {
                document.getElementById('arrow1').classList.remove('animated');
                document.getElementById('arrow2').classList.remove('animated');
            }, 2000);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function startExchange() {
            if (isAnimating) return;
            if (!validateInputs()) return;

            isAnimating = true;
            currentStep = 0;

            const p = parseInt(document.getElementById('prime').value);
            const g = parseInt(document.getElementById('generator').value);
            const a = parseInt(document.getElementById('aliceSecret').value);
            const b = parseInt(document.getElementById('bobSecret').value);

            // Reset all displays
            reset();

            updateStatus('üöÄ Starting Diffie-Hellman Key Exchange...', 'info');

            // Step 1: Show public parameters
            await sleep(1000);
            updateStep('Step 1: Setting up public parameters');
            animateCharacter('alice');
            animateCharacter('bob');

            document.getElementById('alice-p').textContent = p;
            document.getElementById('alice-g').textContent = g;
            document.getElementById('bob-p').textContent = p;
            document.getElementById('bob-g').textContent = g;
            document.getElementById('eve-p').textContent = p;
            document.getElementById('eve-g').textContent = g;

            updateCalculations(`
                <div class="formula">Public Parameters:
p (prime) = ${p}
g (generator) = ${g}</div>
                <p>‚úÖ Alice and Bob agree on public prime p=${p} and generator g=${g}</p>
            `);

            // Step 2: Private secrets
            await sleep(2000);
            updateStep('Step 2: Choosing private secrets');
            animateCharacter('alice');
            document.getElementById('alice-a').textContent = a;
            await sleep(500);
            animateCharacter('bob');
            document.getElementById('bob-b').textContent = b;

            updateCalculations(`
                <div class="formula">Public Parameters:
p (prime) = ${p}
g (generator) = ${g}

Private Secrets:
Alice's secret a = ${a} (üîí secret!)
Bob's secret b = ${b} (üîí secret!)</div>
                <p>‚úÖ Alice chooses secret number a=${a}, Bob chooses secret number b=${b}</p>
            `);

            // Step 3: Computing public values
            await sleep(2000);
            updateStep('Step 3: Computing public values');
            animateCharacter('alice');
            const A = modPow(g, a, p);
            document.getElementById('alice-A').textContent = A;

            await sleep(1000);
            animateCharacter('bob');
            const B = modPow(g, b, p);
            document.getElementById('bob-B').textContent = B;

            updateCalculations(`
                <div class="formula">Public Parameters:
p (prime) = ${p}
g (generator) = ${g}

Private Secrets:
Alice's secret a = ${a} (üîí secret!)
Bob's secret b = ${b} (üîí secret!)

Public Values:
A = g^a mod p = ${g}^${a} mod ${p} = ${A}
B = g^b mod p = ${g}^${b} mod ${p} = ${B}</div>
                <p>‚úÖ Alice computes A = g^a mod p = ${g}^${a} mod ${p} = <span class="highlight">${A}</span></p>
                <p>‚úÖ Bob computes B = g^b mod p = ${g}^${b} mod ${p} = <span class="highlight">${B}</span></p>
            `);

            // Step 4: Public exchange
            await sleep(2000);
            updateStep('Step 4: Exchanging public values');
            animateArrows();
            animateCharacter('eve');

            await sleep(1000);
            document.getElementById('alice-B').textContent = B;
            document.getElementById('bob-A').textContent = A;
            document.getElementById('eve-A').textContent = A;
            document.getElementById('eve-B').textContent = B;

            updateCalculations(`
                <div class="formula">Public Parameters:
p (prime) = ${p}
g (generator) = ${g}

Private Secrets:
Alice's secret a = ${a} (üîí secret!)
Bob's secret b = ${b} (üîí secret!)

Public Values:
A = g^a mod p = ${g}^${a} mod ${p} = ${A}
B = g^b mod p = ${g}^${b} mod ${p} = ${B}

Public Exchange:
Alice sends A = ${A} to Bob
Bob sends B = ${B} to Alice
Eve intercepts both: A = ${A}, B = ${B}</div>
                <p>üì° Alice sends A=${A} to Bob over the public channel</p>
                <p>üì° Bob sends B=${B} to Alice over the public channel</p>
                <p>üëÅÔ∏è Eve intercepts both values: A=${A}, B=${B}</p>
            `);

            // Step 5: Computing shared secret
            await sleep(2000);
            updateStep('Step 5: Computing the shared secret');
            animateCharacter('alice');
            const K1 = modPow(B, a, p);
            document.getElementById('alice-K').textContent = K1;

            await sleep(1000);
            animateCharacter('bob');
            const K2 = modPow(A, b, p);
            document.getElementById('bob-K').textContent = K2;

            updateCalculations(`
                <div class="formula">Public Parameters:
p (prime) = ${p}
g (generator) = ${g}

Private Secrets:
Alice's secret a = ${a} (üîí secret!)
Bob's secret b = ${b} (üîí secret!)

Public Values:
A = g^a mod p = ${g}^${a} mod ${p} = ${A}
B = g^b mod p = ${g}^${b} mod ${p} = ${B}

Shared Secret Computation:
Alice computes: K = B^a mod p = ${B}^${a} mod ${p} = ${K1}
Bob computes: K = A^b mod p = ${A}^${b} mod ${p} = ${K2}

Eve cannot compute K without knowing a or b!</div>
                <p>üîê Alice computes K = B^a mod p = ${B}^${a} mod ${p} = <span class="highlight">${K1}</span></p>
                <p>üîê Bob computes K = A^b mod p = ${A}^${b} mod ${p} = <span class="highlight">${K2}</span></p>
                <p>‚ùå Eve cannot compute K without knowing the private secrets a or b!</p>
            `);

            // Final result
            await sleep(2000);
            if (K1 === K2) {
                updateStatus(`üéâ Success! Alice and Bob have established a shared secret: K = ${K1}`, 'success');
                updateStep(`‚úÖ Shared Secret Established: K = ${K1}`);
            } else {
                updateStatus('‚ùå Error: Shared secrets don\'t match!', 'warning');
            }

            animateCharacter('eve');
            document.getElementById('eve-K').innerHTML = '‚ùì<br><small>Needs a or b</small>';

            isAnimating = false;
        }

        function updateCalculations(html) {
            document.getElementById('calculations').innerHTML = html;
        }

        function reset() {
            currentStep = 0;
            isAnimating = false;
            
            // Clear all values
            const elements = [
                'alice-p', 'alice-g', 'alice-a', 'alice-A', 'alice-B', 'alice-K',
                'bob-p', 'bob-g', 'bob-b', 'bob-B', 'bob-A', 'bob-K',
                'eve-p', 'eve-g', 'eve-A', 'eve-B'
            ];
            
            elements.forEach(id => {
                document.getElementById(id).textContent = '-';
            });
            
            document.getElementById('eve-K').textContent = '‚ùå';
            document.getElementById('step').textContent = 'Waiting to start...';
            document.getElementById('step').classList.remove('active');
            
            updateStatus('Enter values and click "Start Key Exchange" to begin!', 'info');
            updateCalculations('<p>The calculations will appear here during the demonstration...</p>');
        }

        function randomValues() {
            const primes = [7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97];
            const p = primes[Math.floor(Math.random() * primes.length)];
            const g = Math.floor(Math.random() * (p - 2)) + 2;
            const a = Math.floor(Math.random() * (p - 1)) + 1;
            const b = Math.floor(Math.random() * (p - 1)) + 1;
            
            document.getElementById('prime').value = p;
            document.getElementById('generator').value = g;
            document.getElementById('aliceSecret').value = a;
            document.getElementById('bobSecret').value = b;
            
            updateStatus('üé≤ Random values generated! Click "Start Key Exchange" to begin.', 'info');
        }
    </script>
</body>
</html>